# 게임플레이 시스템

## 시스템 개요

게임플레이 시스템은 던전 크롤러 게임의 핵심 상호작용 메커니즘을 구현합니다. 이 시스템은 플레이어 캐릭터 조작, 전투, 아이템 관리, 그리고 환경 상호작용을 포함하며, MagicOnion 기반 멀티플레이어 환경에서 원활하게 동작하도록 설계됩니다.

## 구현 목표

1. **응답성 높은 컨트롤**: 지연 없는 캐릭터 조작 및 전투 경험
2. **전략적 깊이**: 단순하지만 숙련도에 따른 차이가 나타나는 전투 시스템
3. **직관적 상호작용**: 명확한 피드백과 이해하기 쉬운 게임 메커니즘
4. **네트워크 동기화**: 다중 플레이어 환경에서의 일관된 게임 상태 유지
5. **확장 가능성**: 추가 기능 및 콘텐츠 확장이 용이한 아키텍처

## 핵심 시스템

### 캐릭터 컨트롤러

#### 이동 시스템
- **입력 처리**: 키보드/게임패드 입력 처리 시스템
- **캐릭터 물리**: 충돌 감지 및 물리 기반 이동
- **애니메이션 연동**: 이동 상태에 따른 애니메이션 전환
- **네트워크 동기화**: 위치 및 회전 동기화 로직

```csharp
// 기본 이동 시스템 인터페이스
public interface IMovementSystem
{
    void Move(Vector3 direction, float speedMultiplier = 1f);
    void Rotate(Vector3 targetDirection);
    void Jump();
    bool IsGrounded();
    Vector3 CurrentVelocity { get; }
}

// 구현 클래스
public class CharacterMovementSystem : IMovementSystem
{
    private CharacterController controller;
    private Animator animator;
    // 추가 필드 및 구현...
}
```

#### 카메라 시스템
- **3인칭 카메라**: 캐릭터 추적 및 충돌 처리
- **줌 기능**: 상황에 따른 카메라 거리 조절
- **충돌 방지**: 벽 및 장애물과의 충돌 회피
- **전투 모드**: 전투 시 최적화된 시야 제공

### 전투 시스템

#### 공격 메커니즘
- **기본 공격**: 근접 및 원거리 기본 공격
- **스킬 시스템**: 쿨다운 기반 특수 능력
- **콤보 시스템**: 타이밍 기반 연속 공격
- **히트박스**: 정밀한 충돌 감지 및 데미지 적용

```csharp
// 공격 시스템 인터페이스
public interface ICombatSystem
{
    void PerformBasicAttack();
    void PerformSkill(int skillIndex);
    bool CanUseSkill(int skillIndex);
    float GetSkillCooldown(int skillIndex);
    void TakeDamage(float amount, DamageType type, GameObject source);
}

// 데미지 타입 열거형
public enum DamageType
{
    Physical,
    Magical,
    True,
    Fire,
    Ice,
    Poison
}
```

#### 방어 및 회피
- **방어 시스템**: 타이밍 기반 방어 및 데미지 감소
- **회피 기동**: 방향 회피 구르기 및 무적 프레임
- **스태미나 관리**: 방어 및 회피 행동의 자원 관리
- **피격 애니메이션**: 히트 반응 및 피드백

#### 체력 및 자원 시스템
- **체력 관리**: 체력 감소 및 회복 메커니즘
- **마나/에너지**: 스킬 사용을 위한 자원 관리
- **상태 이상**: 독, 화상, 기절 등 다양한 상태 효과
- **사망 처리**: 캐릭터 사망 및 부활 시스템

### 아이템 및 인벤토리 시스템

#### 아이템 시스템
- **아이템 분류**: 무기, 방어구, 소비품, 특수 아이템
- **속성 시스템**: 아이템 능력치 및 특수 효과
- **희귀도**: 일반, 고급, 희귀, 전설 등급 구분
- **내구도**: 아이템 사용에 따른 성능 변화

```csharp
// 아이템 기본 클래스
public abstract class Item
{
    public string ID { get; protected set; }
    public string Name { get; protected set; }
    public ItemRarity Rarity { get; protected set; }
    public Sprite Icon { get; protected set; }
    public int MaxStackSize { get; protected set; }
    
    public abstract void Use(Character character);
}

// 아이템 희귀도
public enum ItemRarity
{
    Common,
    Uncommon,
    Rare,
    Epic,
    Legendary
}
```

#### 인벤토리 관리
- **슬롯 기반 시스템**: 제한된 인벤토리 공간
- **아이템 정렬 및 필터링**: 사용자 편의 기능
- **장비 시스템**: 캐릭터 장비 슬롯 및 착용 효과
- **네트워크 동기화**: 인벤토리 상태 서버 동기화

#### 루팅 시스템
- **드롭 테이블**: 몬스터 및 상자 전리품 결정
- **자동 획득**: 범위 내 아이템 자동 습득 옵션
- **팀 분배**: 파티 내 아이템 분배 규칙
- **희귀 아이템 강조**: 가치 있는 아이템 시각적 구분

### 환경 상호작용

#### 상호작용 시스템
- **상호작용 감지**: 근처 상호작용 가능 오브젝트 감지
- **다중 상호작용 옵션**: 컨텍스트에 따른 다양한 행동
- **진행 표시**: 시간이 필요한 상호작용 진행 표시
- **피드백 시스템**: 시각 및 청각적 상호작용 피드백

```csharp
// 상호작용 인터페이스
public interface IInteractable
{
    string GetInteractionPrompt();
    bool CanInteract(Character character);
    void Interact(Character character);
    float GetInteractionDuration();
}
```

#### 함정 및 환경 위험
- **함정 유형**: 다양한 종류의 함정 및 효과
- **환경 피해**: 불, 독, 낙하 등 환경적 위험
- **탐지 및 회피**: 함정 탐지 및 비활성화 메커니즘
- **지속 효과**: 일부 환경의 지속적 영향

#### 특수 오브젝트
- **보물 상자**: 잠금 해제 및 보상 시스템
- **문 및 장애물**: 열쇠 또는 특수 조건 해제
- **제단 및 장치**: 특수 효과 및 혜택 제공
- **워프 포탈**: 던전 내 이동 및 탈출 메커니즘

### 탈출 메커니즘

#### 탈출 포탈
- **타이머 시스템**: 던전 입장 후 시간 경과에 따른 포탈 활성화
- **위치 선정**: 맵 내 전략적 위치에 포탈 생성
- **시각적 표시**: 포탈 위치 및 상태 명확한 표시
- **사용 조건**: 포탈 사용을 위한 조건 (선택적)

#### 보상 시스템
- **탈출 성공 보상**: 생존 보너스 및 추가 보상
- **진행 저장**: 탈출한 아이템 및 경험치 저장
- **실패 페널티**: 탈출 실패 시 일부 손실 메커니즘
- **성취 시스템**: 특수 조건 달성 시 추가 보상

## 포트폴리오 구현 우선순위

1개월 기간 내에 다음 요소들을 우선적으로 구현할 계획입니다:

### 1주차: 기본 캐릭터 컨트롤러 및 전투 기초
- 캐릭터 이동 및 애니메이션 시스템
- 기본 공격 메커니즘 및 히트박스
- 간단한 체력 및 데미지 시스템
- 카메라 제어 및 시점 관리

### 2주차: 아이템 및 인벤토리 기초
- 기본 아이템 시스템 구조
- 단순 인벤토리 UI 및 관리
- 장비 착용 및 효과 시스템
- 보물 상자 및 루팅 기초

### 3-4주차: 환경 상호작용 및 탈출 시스템
- 오브젝트 상호작용 시스템
- 함정 및 환경 위험 기초 구현
- 탈출 포탈 메커니즘
- 네트워크 동기화 통합

## 기술적 도전과 해결책

### 도전 1: 네트워크 지연과 동기화
- **문제**: 네트워크 지연으로 인한 불일치 및 지연 경험
- **해결책**: 클라이언트 측 예측 및 서버 권한 모델 적용, 보간 기법 사용

### 도전 2: 복잡한 전투 동기화
- **문제**: 빠른 전투 액션의 정확한 동기화 어려움
- **해결책**: 이벤트 기반 동기화와 판정 재생산 방식 혼합 사용

### 도전 3: 성능 최적화
- **문제**: 다수의 오브젝트 및 효과로 인한 성능 문제
- **해결책**: 오브젝트 풀링, LOD 시스템, 효율적인 물리 계산

## 평가 기준

포트폴리오 프로젝트로서 이 시스템의 성공 여부는 다음 기준으로 평가합니다:

1. **응답성**: 지연 없는 컨트롤 및 피드백
2. **일관성**: 네트워크 환경에서의 일관된 게임플레이
3. **재미**: 기본적인 게임 루프의 재미 및 참여도
4. **확장성**: 코드 구조의 모듈성 및 확장 가능성
5. **최적화**: 자원 사용 효율성 및 성능

[메인 계획으로 돌아가기](./MasterPlan.md)
